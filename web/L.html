<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="mktree.js"></script>
  <script src="L.js"></script>
  <script type="text/javascript">
    var script = null;

    function registerScript (text) {
      "use strict";

      if (!script) script = document.createElement("script");
      else document.body.removeChild (script);

      script.innerHTML = text;
      document.body.appendChild(script);
    }

    function do_run () {
      var result = window.run ("1", "wizard", "navigate");
      registerScript (result[1]);
      window [result[0]] (); 
    }

    function navigate(i, cr) {
      var result = window.interpret (cr);

      document.getElementById ("output").innerHTML = result[1];
      convertTree (document.getElementById (result[0]), false);

      return i;
    }

    function disable_actions () {
      document.getElementById ("run_button").disabled = true;
      document.getElementById ("export_button").disabled = true;
      document.getElementById ("parsed").innerHTML = "&nbsp;";
      document.getElementById ("wizard").innerHTML = "&nbsp;";
      document.getElementById ("output").innerHTML = "&nbsp;";      
    }

    function enable_actions () {
      document.getElementById ("run_button").disabled = false;
      document.getElementById ("export_button").disabled = false;   
    }

    function do_parse () {
       document.getElementById ("parsed").innerHTML = "&nbsp;";
       document.getElementById ("wizard").innerHTML = "&nbsp;";
       document.getElementById ("output").innerHTML = "&nbsp;";     

       var result = window.parse (document.getElementById ("text").innerText);
       if (result[0] == "1") {
          enable_actions ();
          document.getElementById ("parsed").innerHTML = result[1];
          convertTrees ();
          expandTree ("ast");
          do_highlighting (0, 0, 0, 0);
       } else {
          disable_actions ();
          document.getElementById ("parsed").innerHTML = result[1];       
       }
    }

    function do_highlighting (x, y, z, t) {
       document.getElementById ("text").innerHTML = window.highlight (x, y, z, t);
       event.cancelBubble = true;
    }

    function handleFile (evt) {
      var files = evt.target.files; 
         
      if (window.File && window.FileReader && window.FileList && window.Blob) {
        var fr = new FileReader ();

        for (var i = 0, f; f = files[i]; i++) {
          fr.onload = function (e) {
            document.getElementById("text").innerHTML = "<pre>" + e.target.result + "</pre>";
            disable_actions ();
          };

          fr.readAsText (f);
        }                     
      } 
      else alert('The File APIs are not fully supported by your browser.');
    }

    function convert () {
      var blob = new Blob([window.vertical ? window.vertical () : ""], {type: 'text/plain'});

      window.URL = window.webkitURL || window.URL;

      var href = window.URL.createObjectURL(blob);

      document.getElementById ("save").href = href;
      document.getElementById ("save").textContent = "Download";
      document.getElementById ("save").download = "vertical.t";
    }
  </script>
  <link rel="stylesheet" href="mktree.css" type="text/css">
  <style>
    textarea {
      width:98%;
    }
    header {
      background-color:black;
      color:white;
      text-align:center;
      padding:5px; 
    }
    nav {
      line-height:30px;
      background-color:#eeeeee;
      width:600px;
      float:left;
      padding:5px; 
    }
    section {
      background-color:#aaaaaa;
      width:600px;
      float:left;
      padding:10px; 
    }
    footer {
      background-color:black;
      color:white;
      clear:both;
      text-align:center;
      padding:5px; 
    }
    .scrollable {
      width: 600px;
      height: 500px;
      overflow-y: scroll;
      overflow-x: scroll;
    }
</style>
</head>
<body>

<header>
Header
</header>

<nav>
  <table width="100%">
    <tr>
      <td align="left" width="100%">
        Source code:
        <div class="scrollable" style="height:250px;font-family:monospace;line-height:90%;background-color:white" contentEditable="true" id="text"></div>
      </td>
    </tr>
    <tr>
      <td align="center">
        <hr>
        <button type="button" onclick="do_parse()">Parse</button>&nbsp;&nbsp;
        <input type="file" id="loadFile" name="file">&nbsp;&nbsp;
        <button type="button" onclick="convert()" disabled="true" id="export_button">Export</button>&nbsp;&nbsp;<a href="" id=save></a>&nbsp;&nbsp;
        <button type="button" onclick="do_run()" disabled="true" id="run_button">Run</button>
        <hr>
      </td>
    </tr>    
    <tr>
      <td>
       Abstract syntax tree:
       <div class="scrollable" style="background-color:white" id="parsed"></div>
      </td>
    </tr>
  </table>
</nav>

<section>
<table>
  <tr>
    <td>
      Semantic settings:
      <hr>
      <div id="wizard" style="width:600px;height:250px;background-color:white" align="center">
      </div>
      <hr>
      Interpretation results:
      <hr>
      <div class="scrollable" style="background-color:white;height:540px" id="output">
      </div>
    </td>
  </tr>
</table>
</section>

<footer>
Footer
</footer>

</body>
<script type="text/javascript">
  document.getElementById ("loadFile").addEventListener("change", handleFile, false);      
</script>
</html>
